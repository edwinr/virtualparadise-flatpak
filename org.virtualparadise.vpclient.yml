id: org.virtualparadise.vpclient
runtime: org.kde.Platform
runtime-version: "5.15-24.08"
sdk: org.kde.Sdk
command: virtualparadise
finish-args:
  - "--share=ipc"
  #- "--socket=wayland"
  - "--socket=x11"
  - --device=dri
  - --share=network
  - --persist=.virtualparadise
  - --socket=pulseaudio
modules:
  - name: virtualparadise
    buildsystem: simple
    build-commands:
      - chmod +x VirtualParadise.AppImage
      - ./VirtualParadise.AppImage --appimage-extract
      - install -D squashfs-root/usr/bin/virtualparadise /app/bin/virtualparadise.bin
      - install -D virtualparadise.sh /app/bin/virtualparadise
      - >
        install -D -t /app/lib \
          squashfs-root/usr/lib/icudtl.dat \
          squashfs-root/usr/lib/libcef.so \
          squashfs-root/usr/lib/libcrypto.so.1.1 \
          squashfs-root/usr/lib/libGLU.so.1 \
          squashfs-root/usr/lib/libogg.so.0 \
          squashfs-root/usr/lib/libopus.so.0 \
          squashfs-root/usr/lib/libopusfile.so.0 \
          squashfs-root/usr/lib/libssl.so.1.1 \
          squashfs-root/usr/lib/snapshot_blob.bin \
          squashfs-root/usr/lib/v8_context_snapshot.bin
      - >
        install -D -t /app/lib \
          squashfs-root/usr/lib/chrome_100_percent.pak \
          squashfs-root/usr/lib/chrome_200_percent.pak \
          squashfs-root/usr/lib/resources.pak
      - >
        install -D -t /app/lib/virtualparadise \
          squashfs-root/usr/lib/virtualparadise/libvpvkrenderer.so \
      - install -D -t /app/lib/virtualparadise/locales squashfs-root/usr/lib/virtualparadise/locales/en-US.pak
      - mkdir -p /app/share/virtualparadise
      - cp -R squashfs-root/usr/share/virtualparadise/* /app/share/virtualparadise/
      - install -D -t /app/share/pixmaps/virtualparadise squashfs-root/usr/share/pixmaps/virtualparadise/*
    cleanup:
      - '*.AppImage'
      - 'squashfs-root'
    sources:
      - type: file
        path: virtualparadise.sh
      - type: file
        dest-filename: VirtualParadise.AppImage
        url: https://static.virtualparadise.org/downloads/Virtual_Paradise-0.4.10-1-x86_64.AppImage
        sha256: 5b9e237c2092449ef957207c4c9bcd92c12da9364883a13809084f6294e4f366
        only-arches: [x86_64]
  - name: zypak
    sources:
      - type: git
        url: https://github.com/refi64/zypak.git
        branch: main
        commit: ded79a2f8a509adc21834b95a9892073d4a91fdc